# Контроль доступа #
------------

`LIA-admin` имеет встроенный модуль управления разрешениями `RBAC`, в меню админпанели вы можете найти панель управления пользователями, разрешениями и ролями, используя управление разрешениями следующим образом: 

Разрешение маршрута
------------
В `LIA-admin`, разрешения и маршруты связаны друг с другом, на странице редактирования разрешений, устанавливаются разрешения которые могут обращаться к маршрутизации, в поле `HTTP method` выберите метод доступа к пути, в текстовой области `HTTP path` заполните путь доступа.

Например, чтобы добавить разрешение, разрешение может получить доступ к пути `/admin/users` метода GET, затем `HTTP method` выбрать `GET`, в `HTTP path` вписать `/users`.

Если вы хотите получить доступ ко всем путям с префиксом `/admin/users`, тогда в `HTTP path` вписать `/users*`, если разрешения включают несколько путей доступа, оберните строку для каждого пути.

Разрешение страницы
------------
Если вы хотите контролировать права пользователя на странице, вы можете обратиться к следующему примеру

#### пример 1 ####
Например, теперь есть сцена, здесь есть модуль статьи, в качестве примера мы используем статьи для создания

Сначала откройте `http://localhost/admin/auth/permissions`, заполните поле slug с текстом `create-post` и `Create post` в поле имени, затем назначьте это разрешение для необхлдимых ролей.

В действии вашего контроллера:
```php
use Lia\Auth\Permission;

class PostController extends Controller
{
    public function create()
    {
        // проверить разрешение, только роли с разрешением `create-post` могут посетить это действие
        Permission::check('create-post');
    }
}
```
#### пример 2 ####
Если вы хотите управлять элементами страницы на дисплее пользователя, вам необходимо сначала определить разрешения, такие как `delete-image` и `view-title-column`, соответственно, для управления разрешениями для удаления изображений и отображения столбца в сетке, затем назначьте эти два разрешения роли, добавьте следующий код в сетку:
```php
$grid->actions(function ($actions) {

    // Роли с этим разрешением не смогут увидеть кнопку удаления в столбце действий.
    if (!Admin::user()->can('delete-image')) {
        $actions->disableDelete();
    }
});

// Только роли с разрешением `view-title-column` могут просматривать этот столбец в сетке
if (Admin::user()->can('view-title-column')) {
    $grid->column('title');
}
```

Другие методы
------------
Получить текущий объект пользователя.
```php
Admin::user();
```
Получить текущий идентификатор пользователя.
```php
Admin::user()->id;
```
Получите роли пользователя.
```php
Admin::user()->roles;
```
Получите разрешения пользователя.
```php
Admin::user()->permissions;
```
Пользователь - это роль.
```php
Admin::user()->isRole('developer');
```
У пользователя есть разрешение.
```php
Admin::user()->can('create-post');
```
У пользователя нет разрешения.
```php
Admin::user()->cannot('delete-post');
```
Является ли пользователь супер администратором.
```php
Admin::user()->isAdministrator();
```
Является пользователем в одной из ролей.
```php
Admin::user()->inRoles(['editor', 'developer']);
```

Разрешение middleware
------------
Вы можете использовать промежуточное ПО разрешения в маршрутах для управления разрешением маршрутизации
```php
// Разрешить ролям `administrator` и `editor` обращаться к маршрутам под группой.
Route::group([
    'middleware' => 'admin.permission:allow,administrator,editor',
], function ($router) {

    $router->resource('users', UserController::class);
    ...

});

// Запретить роли `developer` и` operator` доступ к маршрутам под группой.
Route::group([
    'middleware' => 'admin.permission:deny,developer,operator',
], function ($router) {

    $router->resource('users', UserController::class);
    ...

});

// У пользователя есть разрешение `edit-post`,` create-post` и `delete-post` могут обращаться к маршрутам в группе.
Route::group([
    'middleware' => 'admin.permission:check,edit-post,create-post,delete-post',
], function ($router) {

    $router->resource('posts', PostController::class);
    ...

});
```
Использование middleware для разрешения аналогично использованию другого middleware.